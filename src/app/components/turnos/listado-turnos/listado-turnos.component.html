<div class="filters">
  <mat-accordion class="accordion" multi>
    <app-custom-filter
      filterName="specialties"
      [items]="Specialties"
      (filterSet)="getFilterSpecialties($event)"
    ></app-custom-filter>

    <app-custom-filter
      filterName="doctors"
      [items]="Doctors"
      (filterSet)="getFilterDoctors($event)"
    ></app-custom-filter>

    <app-custom-filter
      filterName="patients"
      [items]="Patients"
      (filterSet)="getFilterPatients($event)"
    ></app-custom-filter>
  </mat-accordion>
</div>

<mat-spinner
  *ngIf="cargando"
  [diameter]="150"
  style="margin: 10% auto"
></mat-spinner>
<table
  mat-table
  [dataSource]="dataSource"
  class="mat-elevation-z8"
  *ngIf="!cargando"
  class="table-responsive"
>
  <!-- Nombre Column -->
  <ng-container matColumnDef="especialidad">
    <th mat-header-cell *matHeaderCellDef>{{ "specialties" | translate }}</th>
    <td mat-cell *matCellDef="let element">{{ element.especialidad.name }}</td>
  </ng-container>

  <!-- Apellido Column -->
  <ng-container matColumnDef="medico">
    <th mat-header-cell *matHeaderCellDef>{{ "doctor" | translate }}</th>
    <td mat-cell *matCellDef="let element">{{ element.medico.name }}</td>
  </ng-container>

  <!-- Dni Column -->
  <ng-container matColumnDef="paciente">
    <th mat-header-cell *matHeaderCellDef>{{ "patient" | translate }}</th>
    <td mat-cell *matCellDef="let element">{{ element.paciente.name }}</td>
  </ng-container>

  <!-- Correo Column -->
  <ng-container matColumnDef="fecha">
    <th mat-header-cell *matHeaderCellDef>{{ "date" | translate }}</th>
    <td mat-cell *matCellDef="let element">{{ element.fecha }}</td>
  </ng-container>

  <!-- Edad Column -->
  <ng-container matColumnDef="hora">
    <th mat-header-cell *matHeaderCellDef>{{ "time" | translate }}</th>
    <td mat-cell *matCellDef="let element">{{ element.hora }}</td>
  </ng-container>
  <ng-container matColumnDef="estado">
    <th mat-header-cell *matHeaderCellDef>{{ "state" | translate }}</th>
    <td mat-cell *matCellDef="let element">
      {{ element.estado | enumAsString: Estados }}
    </td>
  </ng-container>

  <ng-container matColumnDef="atender" *ngIf="typeUser === 'Medico'">
    <th mat-header-cell *matHeaderCellDef>{{ "accept" | translate }}</th>
    <td mat-cell disabled="true" *matCellDef="let element">
      <mat-icon
        *ngIf="!turno_pasado && element.estado === 0"
        aria-hidden="false"
        aria-label="Example home icon"
        (click)="changeStateShift('ACEPTAR', element)"
        >done</mat-icon
      >
    </td>
  </ng-container>

  <ng-container matColumnDef="cancelar">
    <th mat-header-cell *matHeaderCellDef>{{ "cancel" | translate }}</th>
    <td mat-cell *matCellDef="let element">
      <mat-icon
        *ngIf="!turno_pasado && canCancel(element.estado)"
        aria-hidden="false"
        aria-label="Example home icon"
        (click)="changeStateShift('CANCELAR', element, typeUser)"
        >report_problem</mat-icon
      >
    </td>
  </ng-container>
  <ng-container matColumnDef="finalizar">
    <th mat-header-cell *matHeaderCellDef>{{ "finish" | translate }}</th>
    <td mat-cell *matCellDef="let element">
      <mat-icon
        *ngIf="!turno_pasado && element.estado === 1"
        aria-hidden="false"
        aria-label="Example home icon"
        (click)="changeStateShift('FINALIZADO', element, typeUser)"
        >offline_pin</mat-icon
      >
    </td>
  </ng-container>

  <ng-container matColumnDef="encuesta">
    <th mat-header-cell *matHeaderCellDef>{{ "survey" | translate }}</th>
    <td mat-cell *matCellDef="let element">
      <mat-icon
        *ngIf="element.estado == 5 && !element.encuesta"
        aria-hidden="false"
        aria-label="Example home icon"
        (click)="addSurvey(element)"
        >assignment_late</mat-icon
      >
    </td>
  </ng-container>
  <ng-container matColumnDef="resena">
    <th mat-header-cell *matHeaderCellDef>{{ "review" | translate }}</th>
    <td mat-cell *matCellDef="let element">
      <mat-icon
        *ngIf="element.resena"
        aria-hidden="false"
        aria-label="Example home icon"
        (click)="seeReview(element)"
        >assignment</mat-icon
      >
    </td>
  </ng-container>
  <ng-container matColumnDef="calificar"  *ngIf="typeUser === 'Paciente'">
    <th mat-header-cell *matHeaderCellDef>{{ "rate" | translate }}</th>
    <td mat-cell *matCellDef="let element">
      <mat-icon
        *ngIf="element.estado == 5 && !element.calificacion"
        aria-hidden="false"
        aria-label="Example home icon"
        (click)="addRate(element)"
        >grade</mat-icon
      >
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
</table>

<mat-paginator
  [pageSizeOptions]="[5, 10, 20]"
  showFirstLastButtons
></mat-paginator>
